build:
    image: default-bionic
    environment:
        php: 8.1.2
        mysql: '5.7'
        node: '12'
        hosts:
            laravel.dev: '127.0.0.1'
        variables:
            APP_KEY: 'base64:OYl4Bk9ekouOUIRXyeTD0FVi+cJ9D+HMyDJBgSBSUuI='
            APP_ENV: 'testing'
            APP_URL: 'http://laravel.dev'
            API_HOST: 'laravel.dev'
            DB_HOST: '127.0.0.1'
            DB_DATABASE: 'scrutinizer'
            DB_USERNAME: 'root'
            DB_PASSWORD: ''
            MAIL_DRIVER: 'log'
    cache:
        directories:
            - node_modules
            - vendor/
            - ~/.composer/cache/
    tests:
        before:
            - chmod -R 777 storage
            - chmod -R 777 bootstrap/cache
            - npm run production
        override:
            -
                command: vendor/bin/phpunit --coverage-clover=laravel-test-examples-coverage
                coverage:
                    file: laravel-test-examples-coverage
                    format: clover
    nodes:
        analysis:
            project_setup:
                override:
                    - 'true'
            tests:
                override:
                    - php-scrutinizer-run
                    -
                        command: phpcs-run
                        use_website_config: true
                    - js-scrutinizer-run
        coverage:
            services:
                mysql: 5.7
            tests:
                before:
                  - command: 'cp .env.example .env'
                  - command: "mysql -e 'create database scrutinizer;'"
                override:
                  - command: './vendor/bin/phpunit --coverage-clover=build/logs/clover.xml'
                    coverage:
                      file: build/logs/clover.xml
                      format: clover
        tests: true
filter:
    paths:
        - 'app/*'
    excluded_paths:
        - 'app/views/*'
        - 'app/config/*'
        - 'app/database/*'
checks:
    php:
        remove_extra_empty_lines: true
        remove_php_closing_tag: true
        remove_trailing_whitespace: true
        fix_use_statements:
            remove_unused: true
            preserve_multiple: false
            preserve_blanklines: true
            order_alphabetically: true
        fix_php_opening_tag: true
        fix_linefeed: true
        fix_line_ending: true
        fix_identation_4spaces: true
        fix_doc_comments: true
    javascript: true
coding_style:
    php: {  }
